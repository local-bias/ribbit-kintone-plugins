import { z } from 'zod';
import { ImageFormatSchema } from './image';

export const PluginConditionV1Schema = z.object({
  /**
   * ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨­å®šã‚’ä¸€æ„ã«è­˜åˆ¥ã™ã‚‹ãŸã‚ã®ID
   * è¨­å®šã®ä¸¦ã³æ›¿ãˆã«ä½¿ç”¨ã•ã‚Œã¾ã™
   */
  id: z.string(),
  /** DnDã‚¨ãƒªã‚¢ã‚’è¨­ç½®ã™ã‚‹ã‚¹ãƒšãƒ¼ã‚¹ã®ã‚¹ãƒšãƒ¼ã‚¹ID */
  targetSpaceId: z.string(),
  /** å¤‰æ›å¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚³ãƒ¼ãƒ‰ */
  targetFileFieldCode: z.string(),
  /** å¤‰æ›ã™ã‚‹ç”»åƒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ */
  imageFormat: ImageFormatSchema,
  /** ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’æœ‰åŠ¹ã«ã™ã‚‹ç”»é¢ */
  targetEvents: z.array(z.enum(['create', 'edit', 'detail'])),
  /** DnDã‚¨ãƒªã‚¢å†…ã«è¡¨ç¤ºã™ã‚‹èª¬æ˜æ–‡ */
  dropzoneDescription: z.string(),
  /** æ¨™æº–ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç„¡åŠ¹ã«ã™ã‚‹ã‹ã©ã†ã‹ */
  disableVanillaFileField: z.boolean(),
  // /** ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã®ä¸Šé™ */
  // maxFileSizeKB: z.number(),
});
export const PluginConfigV1Schema = z.object({
  version: z.literal(1),
  common: z.object({}),
  conditions: z.array(PluginConditionV1Schema),
});
type PluginConfigV1 = z.infer<typeof PluginConfigV1Schema>;

export const AnyPluginConfigSchema = z.discriminatedUnion('version', [PluginConfigV1Schema]);

export const LatestPluginConditionSchema = PluginConditionV1Schema;

/** ğŸ”Œ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒã‚¢ãƒ—ãƒªå˜ä½ã§ä¿å­˜ã™ã‚‹è¨­å®šæƒ…å ± */
export type PluginConfig = PluginConfigV1;

/** ğŸ”Œ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å…±é€šè¨­å®š */
export type PluginCommonConfig = PluginConfig['common'];

/** ğŸ”Œ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è©³ç´°è¨­å®š */
export type PluginCondition = PluginConfig['conditions'][number];

/** ğŸ”Œ éå»å…¨ã¦ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å«ã‚€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è¨­å®šæƒ…å ± */
export type AnyPluginConfig = z.infer<typeof AnyPluginConfigSchema>;
