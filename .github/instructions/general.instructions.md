---
applyTo: '**'
---

## 概要

サイボウズ株式会社が提供するクラウドサービス「kintone」上で動作するプラグインを、React と TypeScript を用いて開発します。

複数のプラグインを、TurboRepo を使用して monorepo で管理します。各プラグインは独立したエントリポイントを持ち、設定画面と動作画面で異なるスクリプトが読み込まれます。

## アーキテクチャ

### 技術スタック

- **フレームワーク**: React
- **UI ライブラリ**: material-ui
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS v4
- **状態管理**: Jotai
- **ビルドツール**: ESBuild
- **型定義**: zod
- **パッケージ管理**: pnpm
- **モノレポ管理**: TurboRepo

### アーキテクチャパターン

- **クライアントサイドレンダリング**: アプリケーションはすべてクライアント側で実行されます。
- **コンポーネントベース**: 機能別にコンポーネントを分離
- **状態の局所化**: 各コンポーネントで必要な状態のみを管理

## モノレポ構造

このプロジェクトは TurboRepo を使用してモノレポ構造で管理されます。以下のディレクトリ構造を持ちます：

```
├── apps/ (アプリケーション)
│   ├── plugin-a/ (プラグインA)
│   ├── plugin-b/ (プラグインB)
│   └── plugin-c/ (プラグインC)
├── packages/ (パッケージ)
│   ├── constants/ (定数)
│   ├── library-a/ (ライブラリA)
│   ├── library-b/ (ライブラリB)
│   └── jotai/ (プラグイン共通の Jotai ストア)
```

### プラグイン構造

この kintone プラグインは以下の 2 つの独立したエントリポイントを持ちます：

#### エントリポイント

- **設定画面**: `src/config/index.ts`
  - プラグインの設定画面で実行されるスクリプト
  - ビルド時に `config.js` として生成される
  - kintone のプラグイン設定画面から script タグで読み込まれる

- **動作画面**: `src/desktop/index.ts`
  - アプリの一覧画面・詳細画面で実行されるスクリプト
  - ビルド時に `desktop.js` として生成される
  - kintone のアプリ画面から script タグで読み込まれる

#### ビルド成果物

```
build/
├── config.js     # 設定画面用スクリプト
├── config.css    # 設定画面用スタイル
├── desktop.js    # 動作画面用スクリプト
├── desktop.css   # 動作画面用スタイル
└── manifest.json # プラグインマニフェスト
```

各スクリプトは独立してコンパイルされ、異なる kintone 画面で個別に読み込まれるため、相互依存はありません。

## 各プラグインディレクトリ構造と役割

### プラグインディレクトリ構造

```
src/
└── components/ (汎用コンポーネント)
    ├── jotai/ (Jotaiが組み込まれたコンポーネント)
    └── ui/ (UIコンポーネント)
└── config/ (設定画面)
    ├── components/ (設定画面用コンポーネント)
    ├── hooks/ (設定画面用フック)
    ├── states/ (設定画面用状態管理)
    ├── app.tsx (設定画面のエントリポイント)
    ├── index.ts (設定画面用jsファイルのエントリポイント)
    └── main.tsx (index.tsとapp.tsxを仲介するファイル)
├── contents/ (静的コンテンツ)
└── desktop/ (動作画面)
    ├── components/ (動作画面用コンポーネント)
    ├── hooks/ (動作画面用フック)
    ├── states/ (動作画面用状態管理)
    └── index.ts (動作画面用jsファイルのエントリポイント)
├── lib/ (ライブラリ)
├── schema/ (スキーマ)
    └── plugin-config.ts (プラグイン設定スキーマ)
├── styles/ (スタイル)
└── types/ (型定義)
```

### 各ディレクトリの役割

- `components/`: 設定画面、動作画面で共通して使用される汎用コンポーネントを格納します。
  - `jotai/`: Jotai が組み込まれたコンポーネントを格納します。
  - `ui/`: UI コンポーネントを格納します。
- `config/`: 設定画面に関連するコードを格納します。設定画面用のコンポーネント、フック、状態管理が含まれます。
- `contents/`: 静的なコンテンツ（画像やフォントなど）を格納します。読み取る必要はありません。
- `desktop/`: 動作画面に関連するコードを格納します。動作画面用のコンポーネント、フック、状態管理が含まれます。
- `lib/`: 設定画面、動作画面で共通して使用されるライブラリやユーティリティ関数を格納します。
- `schema/`: zod スキーマを定義するディレクトリです。
  - `plugin-config.ts`: プラグイン設定のスキーマを定義します。設定画面でここで定義されたスキーマを使用して、設定のバリデーションを行います。
- `styles/`: Tailwind CSS の設定やカスタムスタイルを格納します。
